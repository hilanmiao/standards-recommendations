# Git规范

## Git 分支模型

### master分支

master分支表示一个稳定的发布版本.

- 场景: 所有应用会跟随版本迭代, 在dev分支测试稳定后, 会合并到master分支, 并使用tag标记应用版本
- tag规范: `v{version}`, 例如v0.1.0
- 人员: 由项目负责人进行审核合并, 普通开发者没有权限

### dev分支

开发者主要工作的分支, 最新的特性或bug修复都会提交到这个分支. 开发者如果在该分支进行了提交，在push到远程之前应该先pull一下， 并尽量使用rebase模式，保证分支的简洁

- 命名规范: dev
- tag规范: 在dev分支中也可能会经历发布过程, 例如bug修复版本. 这里同样使用tag来标记这些发布. 例如v0.1.1
- 提交规范：如果实在开发分支上进行开发，在推送到远程之前，应该使用`git rebase`形式更新本地分支。

### feature分支

涉及多人协作或者大功能的开发, 应该从dev分支checkout出独立的feature分支, 避免干扰dev分支

- 场景:
  - 涉及多人协作: 团队多个成员在同一个项目下负责开发不同的功能, 这时候每个成员在自己的feature分支独立开发
  - 大功能开发: 大功能开发跨越周期比较长, 需要多次迭代才会稳定. 这时候应该在独立的分支上开发. 方便跟踪历史记录, 也免于干扰dev分支的迭代和发布
- 命名规范
  - feature/name: name是功能名称
  - feature/version: 这也是团队常见的模式, 当无法使用一个功能名称来描述时, 可以使用版本号作为’功能’
- 合并时机
  1. 当feature分支迭代稳定, 并通过测试后, 合并到dev分支. 合并到dev后, **feature分支的生命周期就结束了**. 后续bug修复和功能优化直接在dev开发
  2. 当多个feature分支需要合并对外发布临时版本时. 合并到preview分支 . ⚠️这种情况不应该合并到dev分支, 因为feature分支可能还不稳定或未完成. 比如为了联调某些功能.
- 合并方式
  - 不要使用fast-forward. 这样可以在分支图上查看到分支历史

### preview分支

临时的预览分支, preview分支用于临时合并feature分支, 这其中可能会修复某些bug或者冲突. 可以选择性地将这些提交cherrypick回feature分支. 当预览结束后就可以销毁preview分支

### release分支

遵循gitflow规范

- 场景: 需要为某个正式版本修复bug(hotFix)时, 从master的对应tag中checkout release分支
- 命名规范: release/{version}
- 如何修复
  + 如果对应bug可以在dev分支直接被修复, 可以先提交到dev分支(或者已经修复了), 然后再cherrypick到release分支
  + 如果bug在新版本无法复现. 比如新版本升级了依赖. 那么在release分支直接修复即可


---

## 提交信息规范
一个好的提交信息, 会帮助你提高项目的整体质量.

- why
    - 格式统一的提交信息可以帮助自动化生成changelog
    - 版本库不只是存放代码的仓库, 也记录项目的开发记录. 这些记录应该可以帮助后来者快速地学习和回顾代码. 也应该方便其他协作者review你的代码
- 原则: 半年后, 你能看懂你的commit做了什么东西
- 方式: 使用git commit(打开编辑器)而不是git commit -m
- 必要信息
    - 为什么进行这次提交?
        - 提交改变了什么, 让其他reviewer更容易审核代码和忽略无关的改变
    - 如何解决的问题?
        - 问题是什么导致的？
        - 简短说明使用什么方式, 策略, 修复了问题.
    - 变化可能影响哪些地方
        - 说明变动功能的细节。 一个提交不应该做超过2个功能的变动

### 格式

[Conventional Commits](https://www.conventionalcommits.org/zh-hans/v1.0.0/) (约定式提交)脱胎于Angular提交信息准则，提供了更加通用、简洁和灵活的提交规范

### 信息交互工具
[Commitizen](http://commitizen.github.io/cz-cli/) 是一个提交日志工具，辅助开发者使用提交规则
